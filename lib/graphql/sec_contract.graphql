fragment SearchResult on sec_contract {
  accession_number
  sequence
  company_name
  company_cik
  # company_geo
  filing_type
  # filing_metadata
  filing_date
  description
  attachment_type
}

# description: { _ilike: "%purchase and sale%", _nilike: "%amendment%" }
query SearchSECContracts($search: String!, $minDate: date, $maxDate: date) {
  sec_search_aggregate(
    args: {
      search: $search
      filing_date_gt: $minDate
      filing_date_lt: $maxDate
    }
  ) {
    aggregate {
      filing_count: count(columns: accession_number, distinct: true)
      company_count: count(columns: company_cik, distinct: true)
      count
    }
  }
  sec_search(
    args: { search: $search }
    limit: 20
    order_by: { relevance: desc }
  ) {
    ...SearchResult
  }
}
